////////////////////////////////////////////////////////////////////////////////////////////////
//	Constantes :
////////////////////////////////////////////////////////////////////////////////////////////////
#define MP_SETUP_CHAT_MAX_SIZE 2048 //tamaño maximo no truncado
#define SEH_HANDLER_ADDR 0x00526EDA
#define JMP_ESP 0x7c874413//KERNEL32.DLL (XP SP3) || 0x77dbf069 ADVAPI32.DLL (XP SP3 ESP) || 0x77def069 (XP SP3 EN)

#define DPID_ALLPLAYERS 0

#define MAX_PLAYERS 8
#define MAX_PLAYERNAME_LENGTH 32
#define MAX_MESSAGE_LENGTH 255
#define MAX_MAPNAME_LENGTH 255
#define FULL_CHAT_MESSAGE_LENGTH MAX_PLAYERNAME_LENGTH+MAX_MESSAGE_LENGTH+2 //": "

#define PING 1
#define CIV 2
#define COLOR 3
#define TEAM 4
#define CHAT 5
#define STATUS 6
#define VERSION 7

#define TX_PING 0x31
#define TX_PONG 0x32
#define MP_SETUP_SCREEN 0x35
#define MP_SETUP_SCREEN_CIV 0x34
#define MP_SETUP_SCREEN_COLOR 0x35
#define MP_SETUP_SCREEN_TEAM 0x36
#define MP_SETUP_SCREEN_IS_PLAYER_ALIVE 0x30
#define MP_SETUP_CHAT_RESP 0x41
#define MP_SETUP_CHAT 0x43
#define MP_SETUP_PLAYER_READY 0x52
#define MP_SETUP_DATA 0x5A   

#define STATUS_READY 0x01
#define STATUS_NOT_READY 0x00
////////////////////////////////////////////////
//Constantes de configuracion de la partida
////////////////////////////////////////////////
#define MP_GAME_SETTING_CHEATS 0x1
#define MP_GAME_SETTING_LOCKSPEED 0x4
#define MP_GAME_SETTING_LOCKTEAMS 0x8
#define MP_GAME_SETTING_REC 0x10
#define MP_GAME_SETTING_TOGETHER 0x40
#define MP_GAME_SETTING_TECHS 0x80

#define STANDARD 0

#define GAMETYPE_RM 0
#define GAMETYPE_REGICIDE 1
#define GAMETYPE_DEATHMATCH 2
#define GAMETYPE_CS 3
#define GAMETYPE_KINGOFHILL 5
#define GAMETYPE_WONDERRACE 6
#define GAMETYPE_DEFENDTHEWONDER 7

#define VICTORY_CONQUEST 1
#define VICTORY_TIMELIMIT 7
#define VICTORY_SCORE 8
#define VICTORY_INDIVIDUAL 0x0B
//Mapa
#define MIN_STMAP_ID	9
#define MAX_STMAP_ID	33
#define MIN_RWMAP_ID	34
#define MAX_RWMAP_ID	43
#define CUSTOM          44
#define LRANDOM			45 // random land map
#define RRANDOM			47 // real world random map
#define BLINDRANDOM     48
//Civs
#define RANDOMCIV		30
//Estado
#define STATUS_READY1	0x01	
#define STATUS_READY2	0x02	
#define STATUS_READY3	0x04	
#define STATUS_READY4	0x08	
#define STATUS_READY5	0x10	
#define STATUS_READY6	0x20	
#define STATUS_READY7	0x40	
#define STATUS_READY8	0x80	
//Slots
#define CLOSED  		0x01
#define PLAYER  		0x02
#define SYSTEM  		0x04
////////////////////////////////////////////////////////////////////////////////////////////////
//	Estructuras :
////////////////////////////////////////////////////////////////////////////////////////////////
typedef struct
{
//	DWORD	lpNextEntry;
	DWORD	lpSEH;
} SEHEntry;

typedef struct
{
	DWORD	lpReturnAddress;
} RETNADDR;

typedef struct
{
	BYTE	bMsgType; //name ping civ color version team chat status
	BYTE	bPlayerId; //irrelevante en chat
	union {
		DWORD	dwId; //ping civ color version team status (ping, version?)
		BYTE	szData[FULL_CHAT_MESSAGE_LENGTH]; //chat o playername
    };
} _MP_SCREEN_PLAYER_INFORMATION;

typedef struct
{
    LPSTR   lpszSessionNameA;
    GUID    guidInstance;
} _MP_SESSION_INFORMATION;

typedef struct
{
    BYTE	bMsgType;
	BYTE    bMsgSubType;
    WORD    wReserved;
    DWORD   dwReserved;
    DWORD   dwId;
    DWORD   dwReserved2;  
} _MP_SESSION_PACKET;

typedef struct
{
    DWORD	dwMsgType;
	DWORD   dwTime;
} _TX_PING;

typedef struct
{
    DWORD	dwMsgType;
	DWORD   dwChatCounter;
} _MP_SETUP_CHAT_RESP;

typedef struct
{
	BYTE	bMsgType;
	BYTE	bChatCounter;
	WORD	wReserved;
	DWORD	dwUnknown;
	DWORD	dwChatCounter;
	BYTE	bPlayerSource;
	BYTE	bUnknown;
    BYTE	Destionation[8];
	WORD	wUnknown;
	DWORD	dwChatMsgLength;
	BYTE    bUnknown2;
    BYTE    szChatMessage[MAX_MESSAGE_LENGTH];
} _MP_SETUP_CHAT;

typedef struct
{
	BYTE	bMsgType;
	BYTE	bReserved;
	WORD	wReserved2;
	DWORD	dwMapUnknown;
	DWORD	dwReserved3; //null
	DWORD	dwReserved4;
	DWORD	dwPlayerId[MAX_PLAYERS];
	BYTE	bStatusFlags; //players status (slot cerrada/abierta = ready)
	BYTE	bReserved5[7];
	BYTE	bReserved6[8];
	BYTE	bReserved7[8];
	BYTE	bReserved8[8];
	BYTE	bReserved9[7];
	BYTE	bSlotsFlags[MAX_PLAYERS/2]; //abierta+sistema+cerrada+humano
	BYTE	bReserved10[5];
	BYTE	bReserved11[8];
	BYTE	bReserved12[8];
	BYTE	bReserved13[8];
	BYTE	bMapFlagsUnknown;
	BYTE	bReserved14[7];
	BYTE	bSettingsFlags; //rec trampas etc
	BYTE	bSpeedShowmapFlags; 
	BYTE	bGameType; 
	BYTE	bStartingageResFlags; //edad inicial/recursos
	BYTE	bMapsizeDifficultyFlags; 
	BYTE	bMapId;
	BYTE	bVictoryType;
	BYTE	bReserved15;
	WORD	wVictoryConditionValue; //time/score
	BYTE	bMaxPopulation;
	BYTE	bVersion[MAX_PLAYERS]; //flags de version
	BYTE	bPlayersCivs[MAX_PLAYERS];
	BYTE	bReserved16[5];
	BYTE	bReserved17[7];
	BYTE	bColor[MAX_PLAYERS/2]; //colores de los jugadores
	BYTE	bPlayersTeams[MAX_PLAYERS];
	BYTE	bScenarioNameLength;
	BYTE	bReserved18;
	BYTE	bMapNameLength; //¿En verdad es BYTE?
	BYTE	bReserved19[2];
	BYTE	bReserved20[4];
	BYTE	szMapName[MAX_MAPNAME_LENGTH];
} _MP_SETUP_DATA;